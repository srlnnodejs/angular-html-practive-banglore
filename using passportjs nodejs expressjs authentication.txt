authentication using nodejs passport and expressjs
==================================================
>ham authenticatin karenge wo bhi backend validation ke satha
>jese ke aap dekh sakte hai kii ham hamare desktop me node authentication name
ka directory open kea hai
>mene usme switch karke rakha hai
>eek npm project ko init karna hogga too islea hamko pehele npm init --y likhna
hoga
>uske bad hamee kuch package koo install karna hoga wo hoga express or ejs
>ejs templating librrary hai hbs ke tarah farak bas itna hai kiii ejs more 
power full hai hbs seee
>ham ismee hbs see kam code likh ke bohot sara kam karsakte hai
>uske alawa hamme data base se connect karne ke lea mongoose chaihai
>uske alawa hamee eek dev dependency ka module chaihai wo haai kee nodemon ttoo
ham eek self refreshing server create karsakte
>or nodemon ko install karne ke bad hamme package.json mee thoda change karna
padega
>"scripts":{
"start":"node index",
"dev":"nodemon index"

usme hamee package.json ke file ke andar jaake hamme upar wala thing script ke
andar jake change karna hai
>uske bad hamme index.js file banana hoga wohi hamare entry file hoga
>index.js meee pehele eek basic server create karleta hoon
>index.js
=============
const express=require("express");
const app=express();
app.get("/",(req,res)=>{
res.send("hi from node authentication");
});
const port=process.env.port||5000;
app.listen(port,()=>{
console.log("server listning port ",port);
}
>jese kee upar aap dekhsakte hai kkii yeh eek basic sa code hai
>express ko use karke eek server create kea hai uske bad base route mee ham 
>eek console kea hai
>uske bad hamme hamara termenal me run karna padega and hamme browser jake
>hamme kholna padega 
>hamme browser jake open karna padega 
lcoalhost:5000
to hamme dikhega
hi from node authentication
>yanikii ham good to go haiii 
>mujhe views nain karna haii actually me pehelese hii views  ko likhke rakha hai
>agar mee unke path ko copy karun or url tab me open karun tooo dekhsakte hai
in hammme index view show hoga
>saath mee hamare paas login view bhi hoga uske baad success view hai jo value
ham dihaeege
>even though pehelese hamare paas yeh teeno view available haiii
>actually hame view pages ko change karke html change karke ejs karna padega
>kyun kii ham obviously ejs use karne wallee hai
>satthh me ham idhar alag file banengee routes.js usme sarre routes honge
>to reoute.js
===============
route.js ke andar jaynggee or expressko import karlenege const express
=require("express");
>uske baad ham usme routes ka constructor banaynge  const rouites=express.Router()
>ham rotues ka use kaese use karne walle hai too me likhun
>routes.get hamm get kar rehe haii home routes koo pehele ke tarah ham eek 
call back lenge
>usme hamare forms hoga or arrow function use kaenge or usme ham send karenge
>res.send(":hi iam from rotues");
>kiss module seee ham kiya import kar rehe hai or iss module se ham kiya export
kar rehe haiii isme ham likhengee
>modue.exports=routes;
>to kese banega code in routes.js mee chalo dekhlete hai

routes.js
===========
const express=require("express");
const routes=express.Router();
routes.get("/",(req,res)=>{
res.send("hii  from routes");
});
module.exports=routes;

>uske baad hamee index.js mee import karna padega 
>idhar hamare eek path hoga 
const routes=require("./routes.js");
too hamare index.js kese hoga
>index.js
=============
const express=require("express");
const app=express();
const routes=require("./routes.js");
app.use("/",routes);

const port=process.env.port||5000;
app.listen(port,()=>{
console.log("server listning port ",port);
}
agar aap output dekenge too hamme pata chalega
ouput
=========
hii form routes


>abhi ham ejs use kar rehe hai too ham routes file me ejs koo set karletahooon\
>abb ham set karlete haii view engine koo or hamare view engine hoga ejs
routes.js me kam kartee hai
>app.set("vew engine",'ejs');
>abhi hamme set karna hoga view directory koo abhi view directory koo set karne
ke lea hamme path ko st kar na hai joo core node moudle hai
>too keese hogaa hame path ko import karengee 
const path=require("path");
> abhi ham idhar path desakta haii kiii joo directory koo set  karna haii uska 
name or uske bad path module koo leke   
>too abb ham keese path denge app.set("views",path.join(__dirname,'views'));

>__dirname-hamare project ka directory malum karne ke lea uske bad views 
>actually isko ham routes me nain karna chaihai hamee index.js ke file me 
karna chaihai
>tooo hamare index.js file kese hoga

index.js
============

const express=require("express");
const app=express();
const path=require("path");
app.set("vew engine",'ejs');
const routes=require("./routes.js");
app.set("views",path.join(__dirname,'views'));
app.use("/",routes);
const port=process.env.port||5000;
app.listen(port,()=>{
console.log("server listning port ",port);
}


>abb hamee routes.js  file mee render karna haii kisi bhi view koo too kese 
kanregee kisko render karengee jahan par eek registrion form haiii
>save karte hai or refresh karetee hai or browser ko jake dekhte haiii
kiii eek registration form banjaigaa
>simply bootstrp use karke banaya haii ismee kuch badi baat nain hai
too hamare routes file kese dikheegaa

routes.js
===========
const express=require("express");
const routes=express.Router();
routes.get("/",(req,res)=>{
res.render("index");
res.send("hii  from routes");
});
module.exports=routes;

>too ismee kiay hogaa kiii res.rendr() eek method use karenge koi bhi template
ko render karne ke lea isme kiya hua hai kiii hamare base route me or home
route mee ham index template koo render kea hai 

>iss tarah hamare registraion form aajaiga 
>aab ham dekhte haii registration kee process hai joo kese kam  karta haiii
>node authentication kee agar aham bat karen or kisibhi authientiicaiton ke
process meeeuser ko register karna padta haii too kafi simple hota hai
>hamme jo value chaihai hamm usse fetch karte hai or usse ham database me ham
save karlete haii
>better way save karne ke lea ham joo user ka password hai ham usko encrypt karege
>too isme kiya hoga joo db admin jo super log hai woo iss password ko nahin 
dekhsakte
> signup process thoda tricky hojata hai yahan par signup karne ke lea ham
passport js use karenge eek local starteegy create karengee eek user kooo
find karete hai or uske password ko compare karte hai  agar hamme miljai
too user ko serialize karte haaii  basically or user ke lea eek session 
create kartee haii or usko login karwa dete haii
>yeh sab karne ke lea ham use karte haii pasport js kooo bohot sarre startegy
milta haii passport me  google facebook  local hamee yahapee passport local
use karne wale haaiii isse use karke hamee local data base see authentication
startegy ko run karsakte haiii
>wahan pee bohot sarre startegy haii usmee ham joo bhi use karsakteee haii
uske lea hamme jana padega 
passport.org/packages/
>local startegy ko implement karna thoda tricky haii to me uskooo implement
karne wala hooon
>saath mee ham mongo atalas database use karne wala hoon jisko  mee pehele 
use karchukee haiii
>philal ham sabse pehele apne database ko use karte haiiii
>database mee hamme connect karne ke lea hame likhna parega 
const mongoose=require("mongoose");
>hamme mongodb koo connect karna haii to yahapee jana haaii kiyaa karnegee
>hamme mongodb atalas koo jake pura configuarion karlena haiii
>too jo link aaiga usko mongoose.connect() function ke andar dalke hamme
connect karwalena haii 
>mongoose.connec("url",{useNewUrlParser:true,useUnifiedTopology:true});
>uske baad promise koo catch karne ke lea ham then function use karte haiii
>too me log karunga or dekhungaa kiii data base connected dikh jaigaa
>fine save karlete haii isss  and i hope koi error nain hona chaihai
>agar yeeh kam karega too hamare data base connect ho jaiga or hamme dikjaiga kiii 
data base connected
>for porper connection ke lea 
>iske baad ham registration process ko complete karna haiii too hamme abhi index.js
ke file mee eek route likhna haii joo post route hoga 
too index.js kee file mee likhna haii kiii
app.post("/register",routes);
to hamare index .js file kese dikhega 

index.js
============

const express=require("express");
const app=express();
const path=require("path");
app.set("vew engine",'ejs');
const routes=require("./routes.js");
app.set("views",path.join(__dirname,'views'));
app.get("/",routes);
app.post("/register",routes);
const port=process.env.port||5000;
app.listen(port,()=>{
console.log("server listning port ",port);
}

>routes.js mee abb hame same chaihai  too ham likhenge routes.post too ham ko likhna haii
kii register route or uske bad call bad call back funciton likhna haii frankly speeking
signup process kafi simple haiii signup process mee hamme simply bolna haii ki database
mee data ko dalna hai farak itna rahega kii hame beech me password koo encrypt karna haii

>any way abhi hamme form see data chai hai joo ki post hoga  hamme body parser use karna
hoga or body parser hamme bydefault miljata haii express kee sath hiiii
>hamme routes.js ke andar bodyparser koo leke anna hai 
too hamme abhi routes.js kee file mee kam karna hai 
>orr hamme import karna hai body-parser koo routes.js ke file meee
>const bodyparser=require("body-parser");
>hamme set karna padega bodyparser koo 
uske baad hamme bodyparser koo set karna padega kiiii 
router.use(bodyparser.urlencoded({extended:true});
>too iske baad ham kiya karsakte haiii ham value get karrte haii kii form bodyparser see
>too ham value koo catch kese karengee 
ham likhengee register route kee andar 
var {email,username,password,confirmpassword}=req.body;
>itna hamme karne se nahin hoga hammme index.ejs file mee jake dekhna padega kii hamare
yeh joo name haiwo sahi hai ya nahin haiii
>uske alawa hamme action me jake likhna padega kii <form action="/register" method="POST">
>isko save karlete haii kii hope kiii koi error anna nain chai haiii eek issue hai kiii
>agar hamm register route kee andar koi  http response nahin denge too yeh continues
circulate karta rehega
>too ham kiya karengtee kii ham uss template file koo leke aayngee to hame likhna padega
>render funciton koo hamme use karna padega ham render karna chaigee login kooo 
>agar ham kuch value dalengee register meee or value fill karletee hai uske baad 
hame login koo immedetatly aajyengge 
>too ham dekhe kii hamare code sahi me chalrahaii too abhi ham dekhengee yaha pee kuch
>validation karna padega backend mee obvioulsy hamme frontend validation karna padega
>hamme front end mee hamme dekhna padega sab value hay ya hain or hamme check karna padega
kii dono password sahi hai ya nain
>agar koi aisa insan hoo usse inspect element karna atta hoooo agar usse html css
js sahise atta hi tooo wo in cheez ko achesee pass karsakta haiii
>wo dekhenga kii hamare aap kitna asani see break karwa sakteee too hamme chekck krana
haii kii hamee sab values milraha haii kii nahin
>usme ham bolengee agar if(!email||!username||!password||!confirmpassowrd) isme kuch
bhi nain to hamee kuch error show karna haiii
>issmee mee eek variable use karleta hoon jiska name rehegaa err;
>err me ham eek message pass kardenge usme likhengeee err="plsease fill all the fields"
>iske bad hamme render karke hamme uss error ko show karna haiiii
>too ham kiya karenge ham render kardenge index or uska key bhi rehega err or 
value hamare yahan ki err ki barabar hoga
>agar ham koi bhi value nain dalte haii too hamme error dikhna chaihai
>sabse pehele hamme error dekhana cahihai ejs me koi data hamme show karwane ke lea hamme
templating tag koo use karte haii
>ejs mee koi data hame show karwane ke lea hamme ejs ka templating tag koo use
kartee haii jo hota haii ki doo angle bracesses or do persentage sign
><%%>
>koi value ko show karna hai too hamme first angale bracesses ke sath persentage sign
use karke equal lagana haiii
>or beech mee hamm wo value koo daltee haii jo value koo hamme dekhanna hai
>to ham index.ejs mee hamme kiya dalna haiii 
> <h1><%=err%></h1>
> agar mee browser jaun orr mee refresh karun too hamme pata chalega kii err not defined
>yeeh iss lea kii ham simple java script ham use katee haiii err normaly defined nahain haii
normally ham refresh kar rehe haiii too yeh home route se aa raha haii to hamee koi
err nahin mil raha haiii 
>agar mee /register karun too post request aaiga
>aga mee get request karun too nahin hoga aap ko pata haii ham get request karsakte haii
>too hame post request karne ke lea haame kiay simple java script likhna haiii
>hamme ejs mee java script likhneke lea bhi hamme <% %> dalna haiii
>hamme uske andar hamme likhna hoga ejs mee javascript code likhne ke lea ham simple
template use karte haiiii jisme kiii ham javascript code likhsakte hai
>hamme check karna haiii kii 
<%if(typeof err!="undefined"){%>
>agar err undifined nahin haii to kuch code ko show karna haiii
>sabse pehele hamm <%}%> bracket koo close karle agar yeh undefined naahin hoga tabhi 
hame error show karna haiii
>agar woo undefined hoga tooo obviously hamme kuch karne ka koi jarrurat nain ue  yeh
show nain karega too koi problkemk naahin haii
>to finally ham kese likhngee 
<% if {typeof err!="undefined") {%>
<h1><%= err%>
<%}%>
>abhi ham usse refresh karen hamare error gayab hai  agar mee koi value nahin fill karu
registration form mee agar mee register button dabauuu  too show karega please fill all
the field
>bina koi value fill karke agar mee enter marun too woooo
dikhai gaa kii pls fill all the fields
>main jata hoon bootstrap mee jahan mee eeek bootsrap ka theme
>i think yeh ubuntu style tha   
>too me boottstrap ke theme kee andar jake dismissible use
kartha hooon 
>me dismissible ko copy kar ke isko close karlete haii or ham
ejs mee jake mujhe issme paste karna hogaa
>if block mee dimissible ko paste karleta hoon wo kese dikhega
index.html ke andar 
==================
<%if (typeof err!="undefined"){%>
<div class="alert alert-dismissible alert-danger">
<button type="button" class="close" data-dismiss="alert">$times
</button>
<strong>oh snap! </strong> <a hfref="#" class="alert-link">change
a few things up</a> and try submitting again</div>
<h1><%=err%></h1>
<%}%>
>fark bas yehe ke hame change of few thing ke jaga hamme  
<h1><%=err%></h1> value show karna haiii too ham change of few
thing koo pura hata kee ham error koo paste karlete haii
><%if (typeof err!="undefined"){%>
<div class="alert alert-dismissible alert-danger">
<button type="button" class="close" data-dismiss="alert">$times
</button>
<strong>oh snap! </strong> <a hfref="#" class="alert-link">
<%=err%>
<%}%>

>h1 koo bhi hatake sage karke ham kiya karengeee ham sabko
<strong>kee andar dal dena haiii
>strong ke bahar ka sab mee hata deta hooon
>bas itna kafi haii dismissible use karne ke time me hamme
java bootsratp ka sarre plugin lake end of the html body
ke andar dal dena haii
>ham ejs template mee bhi bootstrap ka plugin dalsaktee haii
body kee andar ham pluging koo lake dalsaktteee haiii


>i hope kii aab ye thoda sahi dikhegaa agar ham main menu me
jaete haii or refresh karte haii tooo  form fiele na bharke
agar ham register dabayngee too hamme red border keee sath
kuch aisa  dikheega Please Fill All The Field close karke
>ham uss value koo dalsakttee haiii
>although hamm  register kii route mee bohot sarrre 
validaiton kar sakteee  haiiiii caeck karna chatte haii kii
email hai yaa nahinnn or koi log check karna chattee haiii
kii koi fake email se generate ho raha haiii kii nnahiin
>username kesaa hhee or password  or email or confirm password
sab validation karsaktee 
>aab ham password or confirm passsowrd dono value koo bhi check
karengee agar dono value same nahin hooo tooo hamme copy karke
hamme upar kaerror niche paste karna haii or likhna haii 
kiii password dont matches\
>mee orr eek password not matches confirm password too kiya 
karengeee
>agar dono valuee same nahain hooo to hamme same karna haii tooo
too ham kiya likhengee hamm copy karke niche likh lenege\
>ham error ko chodengee or likhenngee kii password dont match
>find save karlete haii or dekhtee haii ko value hai or nahin
>agar mee username daldunga or email daldunga or passwrod
agar unmatched chodungaa too hamee error dekhenga password
dont match iske alawa joo chai wwoo validation karsakte haooo
koi farak nain padtaaa
>issme kiya hoga kii agar koi koi value daldea haii by  or 
passwoerd daldea haii agar dono password ka value match nain
karta haiii too ham chatee haii ki dono email and username
should available sirf password match nain karta haii to kiya
hua
>too ham kiya karengegee ham eroro kee sath kuch orr value 
render karengeee
>jese kii email woo email kii barabarhoga or username woo jokii
username kii brarabar hogaaa
>woo ham idhar index kee bad chod dea haii aap dekh sakte hoo
error kee bad ham email and username choda hiiii
if(password!=confirmpassword){
err="password dont match";
res.render("index",{'err':err,'email':email,'username':username});
}

routes.js
===========
const express=require("express");
const routes=express.Router();
const mongoose=require("mongoose");
mongoose.connect("url",{useNewUrlParser:true,useUnifiedTopology:true}).
then(()=>{
console.log("db connected")});
const bodyparser=require("body-parser");
router.use(bodyparser.urlencoded({extended:true}));
routes.get("/",(req,res)=>{
res.render("index");
res.send("hii  from routes");
});

router.post("/register",(req,res)=>{
var{email,username,password,confirmpassword}=req.body;
var err;
if{!email||!password||!confirmpassword){
err="please fill all the fields";
res.render('index',{'err':err});
}
if(password!=confirmpassword){
err="password dont match";
res.render("index",{'err':err,'email':email,'username':username});
}
});

module.exports=routes;

>aab ham ejs koo jate haii  koi value koo chodneke lea hamm
aisa karengee ki ham value ko set karnegee 
>normally value available nain hota hhaaiii
>ham yahan kiya karte haii templating tag ko use karlete haii
or value fill kar rehe haiii ham use karlete haii ternary 
orerator koo or hame use karke aisa likhtee haii  or ham bol
rehe haii kkiii if type of  email not equeal to undefined 
agar email undefind nahin hai to emaiil koo sho karega agar 
undefined haii to kuch show nain karega or empty dekhegaaa.
>kiya likhengee  uska examaplee niche likh lea haii aap deko
<div class="form-group">
<label for="email">enter your email</label>
<input type="email" vlaue="% typeof email !='undefined'?email:'' %">
</div>
>same cheeze ham user name lke lie ham likh lete haiiii
>same email mee value mee joo likhee ham copy karlete haiii
or username mee jake paste karlettea hooon 
>too abbb user name keese dikheega aap janotte hoo ccholo dekhetee
hai
>i hope kii abhi koi issue nahin hogaa
>too hamare user namee kese hogaa ham dikhteee haiiii
<div class="form-group">
<label for="username">cohoose a username</label>
<input type="text" class="form-control"  name="username"
id="username" autocomplete="off"
placeholder="username" value="<% typeof username!='undefined'? 
username:''%>
>i hope abhi koi issue nahin hogaa
>agar mee email dalungaa kuchi bhi or password dalunga kuch bhiii
or username dalunga if passoword match nain hogaa to hamme 
error dikhegaaa
>hamme error dikheega password match nahain hogaa or ham dekhege
yeeh doo value joo username or email choda tha wo vlaue form
mee aagaya hoga
>aab kiya hoga passowrd match ho jaigaa too kiya hogga
>simply hamme databse mee data ko save karna hii to hamee kiya karna
haiiii
too hamme encrypt karna padegaaa password koo too ham kese 
password ko encrypt karengeeee 
>to data koo incrypt karnee ke lea hamme module bcryptjs koo
import karna padegaa orr hammee install karna padegaaa 
npm i bcryptjs
>hamm install karengee or yeh package hamare install hojaiigaa
>isse use karke hamm password koo encrypt karenegee or use 
usskoo compare kareneegeee 
>abi ham dekhetee hai kii iskoo ham isme use karengeee 
>ham becrypt koo bhi andar leyengee ham kiya karengeee 
cosnt bcrypt=requrie("bcryptjs");
>yahan pee itnee mee kam nahin chaleegaa
>or ham kiyakarengee ham check karengee kiii yeh user pehele
see available haii kii nahin  too ham kiya karengee unique ness
daltee haii kii user user mee or unique ness daltee kii email mee
>mai yahan email mee unique ness dalna chattaa hoon yee kiii
eek hii email mee eek hii user
> ismee ham kiya karengee kii if type of error  undefined 
too ham check karengeee kii  user haii ya nahinnn
>obviouslly hamee model chihai ham database connect karelea haii
magar hamare pass ko model nahin model nahin kiii matlab
hamare pass koi collection nahin haiiii.
>ismee puri tarahh se mvc pattern or kisi other pattern mee
use kar raha hooon agar ham cheezo koo alag alag file mee 
rekhengee to samajneemmee hamme asannhogaa
>too ham orr eek file bana lete haii uska name model.js
>inside models.js ke andar
>isme pehele hamm mongoose ko import karengeee or ham isme
user ka schema create karlengeee
>uske bad user schema karne ke lea ham kaengeee const userschema
=new mongoose.Schema({})
>uske bad ham dalengee values kiya kiya ham dalengee 
>hame email eek field lenge jiska type rehega string
>required true matlab yeh hamme eekdam see chaihai hii chaihai
>abhi hamme email ke saath username and password chaihai
>obviously text hii rehengee or simple string hii regengeee
>eek orr cheez haiii joo hame idhar cha rehe haiiiii
>joo is programme ke lea haii orr usko authentication ke lea 
kuch lena or dena nahinnn haiiiii
>jo specific data show karwane ke lea hamm user koo eek or
value dena wala haii jo haiikii messages yeh value rehege
array array hone keii karan hamme idhar array symbol use karna
padega
> message:[{type:string}]
>ham idhar aisa diclare karengee kii iiska har eek item string
hoga
>required nahin haii kii jarurui nahin haii ki user iskoo hamesa
deee
>obviously register karneke time me bhi user hamme yeh value 
nahin dena wala haiiiii
>yeh hamare user schema too ham jo abhi export karengee wo eek
model hoga wo joo kii eek mongoose model haiii to ham kiya likhengee
module.exports=new mongoose.model('user',userschema)
too kiya kia ham iskoo export karne ke lea ham kiya kea 
ham module.exports likhke e usme new mongoose.model likhke
usem model ka name user dea or joo schema haii usko userschema dea
>aab ham isme import kartee haii routes.js file mee
>uske pehele hamare model kesea dikta haii usske dikhlette hai
model.js
============
const mongoose=require("mongoose");
const userschema=new mongoose.Schema({
email:{
type:String,
required:"true},
username:{
type:String,
required:ture,
},
password:{
type:String,
required:true},
messages:[{type:string}]});
module.exports=new mongoose.model("user",userschema);
})
upar wala module ham import karte hai route mee 
us moduel koo hamee reoute mee import karna haiii 
abhi hamme niche search karna hiii kii user exist haii ya nahin
too ham likhengge user.findOne({email:email}),
function(err,data){



})
>uske baad call back milta err and data 
  >uske badd err tab milegaa jab koi error hoo or data tab
kmilega jab koi user exist karta hoooo
>agar hamme error miltaa haii to hame kuch nahin karna haii 
simply hamee error ko throw kar dena haii
>agar ;hamme data milega too issue yeh haii kii koi user
exist karta haiiii
>agar koi data milta haii to mee simply log kardeta hoon user 
exist  by log hamme debug karnee mee asani hoti haiiii
>abhi hamme kiya karna haii error koo set kardena haiii
>err="user already existsss with this emaillll"
>too ham joo if condition ham likhee haii usko kese likhengtee
dekh tee haii
if(typeof err="undefined"){
user.findOne({email:email},function(errl,data){
consle.log("user exists");
err="user already exists with this email";
res.render('index',{'err':err,'email':email,'username':username});
}
agar koi user nahin haai to hamme else kee andar likhnaa haii
>password koo encrypt karna haii or eek user instance koo create
karke hamme  user koo dalna haiiii
>wo ham kese karengee encrypt ko karnee ke lea ham pehele bcrypt koo
call karengee or generate karengee salt
>becrypt kar eek method hota haii kii genSalt(10) genSalt method
sabse pehele eek number leta haii kitna round  10,15,20 by 
default 10 haiii
>uske baad ham eek call back lete haii jaha pee error hoga or
salt hogaa
>kisa hogaa agar error hoga har bar tarah hamme throw karlena
haiiii  agar koi salt milega too hamme password ko hash karlena
haiiii
>agar koii salt milta haiii to ham likheenge 
bcrypt.hash(password) hash karnekee lea ham password koo hash
karna chatte ahiiii or joo salt koo use karna chatte haiii 
wo hoga salt uske baad hamme eek call back milegaa jisme 
error hoga  nahin too hashed value hogiiii
>agar hamme error nahin milta haii to hamme password ka hash 
milegaa
>mujhee bolna haii kii agar error aaiga too throw error
>agar koi error nahin too hamme eek hash milgaya password seee
>by default password joo password rahegiii
>mee password ka value ko hash kee sath set karleta hooon
 >uske baad ham eek user create karlete haiii  woo user 
>'user koo ham joo value dene walle haii woo aisa hahiii kiii
email,username,password
>yeh sab dene ke bad hamme user ko save karlete haiii
>abhi save karne kee time mee bhi hamme error milegaa
>hamme error ,data doo parameter milegaa error hua too 
user save hnahin hua haiiiii
>koi bhiii error haii too hamme error koo throw karlena haiii
>gar error nahin haii ham sucessfully save karlea too mee 
redirect karna chaun gaa dusree route mee 
res.redirect("/login");
>too code kese dihega aabhii route mee thoda dekh lete haiii
29.12
>obviously hammare paas /login available nahain haii
>sablse pehele hamm index .js kee file me jattee hai
"usme login ka eek route banatte haiii
>app.get("/login",routes);
>by default hamme get requst rakhna padeta hame post request 
hoga too ham redirect nahin kar payeenge
>routes .js mee aake hamme code karna hogga
routes.get("/login") jo kii ham 
>routes.get("/login",(req,res)=>{
res.render("login.ejs");
});
ham login
else{
bcrypt.genSalt(10,(err,salt)=>{
if(err) throw err
}

>
>too routes.js file kese dikhegaa 

==========================
routes.js
===========
const express=require("express");
const routes=express.Router();
const mongoose=require("mongoose");
const user=require("./user");
mongoose.connect("url",{useNewUrlParser:true,useUnifiedTopology:true}).
then(()=>{
console.log("db connected")});
const bodyparser=require("body-parser");
router.use(bodyparser.urlencoded({extended:true}));
routes.get("/",(req,res)=>{
res.render("index");
res.send("hii  from routes");
});

router.post("/register",(req,res)=>{
var{email,username,password,confirmpassword}=req.body;
var err;
if{!email||!password||!confirmpassword){
err="please fill all the fields";
res.render('index',{'err':err});
}
if(password!=confirmpassword){
err="password dont match";
res.render("index",{'err':err,'email':email,'username':username});
}
if(typeof err="undefind"){
user..findOne({email:email},function(err,data){
if(err) throw err;
if(data){
console.log("user exists");
err="user already exists with this email....."
res.render("index",{'err':err,'email':email,username:'username'})
}else{
bcrypt.genSalt(10,(err,salt)=>{
if(err) throw err;
bcrypt.hash(password,salt,(err,hash)=>{
if(err) throw err;
password=hash;
user({
email,
username,
password
}).save((err,data)=>{
if(err) throw err;
res.redirect("/login")
})})}}})}});

module.exports=routes;

29.12
after complete registration hame redirect ho jaigaee 
/login koo obvioulsy hameare paas /login nahin haai too hamme
kiya karna padega
>hamme index.js file koo jame dusra route create karna padega
app.get("/login",routes); by default isko get request rakhna
padega hamme post request mee ham redirect nahin karpayeenge
>too hamare index.js file kese dikeheegaa

index.js
============

const express=require("express");
const app=express();
const path=require("path");
app.set("vew engine",'ejs');
const routes=require("./routes.js");
app.set("views",path.join(__dirname,'views'));
app.get("/",routes);
app.post("/register",routes);
app.get("/login",routes);
const port=process.env.port||5000;
app.listen(port,()=>{
console.log("server listning port ",port);
}


>hamme index.js file mee hamee login koo get request rakhna 
padega agar hamme post post request rakhennge too ham 
redirect nahin karpayeege
>or saath hii routes.js mee aake hame yanan paee cote karna
hooga
>routes.get("/login",(req,res)=>{

res.render("/login");

})

>ttooo hamme kiya karna padega ham eek arror function call 
karna padega iss me ham render karegee login.ejs koo or yeh
kam chaljaiggaa
>too ham check kartee yahan paee ham idhar register form koo
jakke ham register kartee haii or dekhtee haii kiii woo login
koo redirect hoo jaiggga
>agar bina koi value dalkee register karnegee to hamme error
milegaa please fill all the field
>agar rnadomly kuch idhar udhar ka daldee or password koo
ham mis matches daldeee to hammee dikhega kiii pasword doesnt 
matches
>agar ham sahi email or sahie name or same password dallel
>too hamme login pagee koo leeke chale jaiiga 
to noow everything working as expetion
>agar mee db koo jakee dekhunn to pata chalegeaa kii hamare idhar
sabhi user present haiiii'
>khaas baat yeh kii sari value idhar hoga but password hai
joo wo encrypt hogaa
>agar koi person aisa hii db ko kholparaha haii phir bhi 
aap ka password koo dikhnea paiiga

>yeh process too kafi asan thaa intresting tab hoga jab ham
passport use karke login ko implement karengeee
>yeh thoda muskil hai although yeh hamme thoda simple 
dikhtahaaiiii 
>yahh passport koo include karna application mee dekhnem ee 
passport js kee andar simple haii or yeh cheez karne mee thoda
difficult hoogaa
>sabse pehele hamme bapis authentication koo jake 
>routes.js koo jake hamme check karna haii ki hame login kese
karette haiiii
>login karne ke lea hamme passport and passport local dono chaihai
>sabse pehele hamme passport and passport local koo install 
karna hoga
>hamme likhna padegaa  npm i passport passport-local
>enter matee haii yeh donoo install ho jaigaa or hamme
eek startergy create karnaa haiiii or puri validation process
ko complete karteee haiii
>dono complete kartte haii dono complete hone kee bad ham
user ko serialize or deserialize dono ko nahin kartee ahi
donokoo hame quote kartee haiiii
>startergy sucessfull hogi too user serialize hogaa or un
sucessfull hogi too user deserialize hogga 
>iss lea hamme thoda bohot code likhaana haii kee local
startegy kee lea 
>sablse pehele hamm routes.js kee file mee ham passport koo
import karletee haiii
>ismee hamme passport koo khalii import karna haii local kooo
import karna nahiiin haiii
>routes.js kee andr likhnaa hai const passport =require("passport");
>iskee badd hamme routes.js kee andar nichee anna haii or yeh
process thoda lamba haii to hamee dihre dhiere hamme sabkuch 
karna haiiii

>yahan mee idhar quote karleta hoon get login route kee upar
//Authentiation startegry 
atuhentication strategy kee lea hamme  chaihai passport local
>hamme kiya karna haii kii hamme require karna haii passport-local
orr passport local see hamme khali Strategy chaihai
too ham keelse lihenegee routes.js kee file kee andar
var localStartegy=require("passport-local").Startegy;
abhi hamme passport koo use karna haii eek Startegy create 
karnee keee lea 35.00
passport.use(new localStartegy());
>yahan par hamara eek new local startegy  hona yahan pee
>sabse pehele hamme local startegy karlena chaihai iss local
strategy mee kuch field hota haiiii by default aap ka username
is username or password is password nahin haai  too hamme isse
change karna hoogaa
>idahar ;hamara username joo field haii usse mee set karleta 
hoon email mee kyun kee email hamara uniqueee haiii
>idhar hamm boeengee kii usernameField haii wo username naa
hokee email haiiii
>kyun kee hame database see front end see hammme email hii 
milnee walla haiiii hope haii kii hamee emaill milne wala hoo
>lets goo to to login change field username to emailll
>too kese kanegge chalo login.ejs
==================================
<div class="form-group">
<label for="username">enter your email</label>
<input type="email" class="form-control" name="email" id="username"
 atuocomplete="off" placeholder="email">
</div>
aisa ham login.ejs koo jakke sab change karsakttee haiii
>hamme aab apna emmail chaihaiii
>hamme lcoalStartegy mee usernameField set karnee kee bad
ham eek call back likheenge usme hame milegaa 
(username,password,done)
>or hamm is call back function koo call kardengee
>hamme check karna haii kii user exist hota haii kii nahin
>'ham kiya likengee kiii user.findOne too hamme find karna 
haii ki query haii kii koi email haii yaa nahinnnn
>tooo ham joo username koo email see change kardea haii too
ham aisa likhngee kii 

user.findOne({username:email})
>asia karne ke bad kiya hoga obviously hamme call back milega
jahan hamme doo parameter milega woo haii eek eerror hota haii
or nahin too data hota hiiii agar koi error milega simple 
sa kam haii ham error  koo throw kardenge
>agar hamme koidata bhi nahin milegaa too iska matlab haii
kii user exist nahin kartaa haiiii
if(!data) iska matlab yeh haii kii user exist nahin karta hiii
>too yahan pee ham joo cheez return kartee hai woo haii done
>agar ham done kee sath null or false passkarenn too yeeh hamare
authentication sucessfull nahin thaa
>iskme lea ham meessage bhi pass karenegee isske lea hamm
request flask pass karengee joouse karengee thodi dermee
>agar hamare dono statement sahi nahin hotaa haiiii
>too fir ham compare karengee hamaree password kooo
too becrypt.compare too kiya compare karna haii kee eek 
password joo user nee abhi enter keea 
>eek password joo kii hamare database see mila 
>isme hame compare karne ke bad hamme eek clallback milega
>call back mee hamare doo parameter rehegaa eek hoga err, 
dusra rehegaa hamare match
>sabse pehele hamme eek annomous arrow function koo use karna haiii
>agar error hai too hamme simply throw error nahin karna hii
 tooo hamare idhar mathch nahin hota haii too hamme
return done(null,false) likhna padegaa
>agar hamme math milraha hii too hamme return karna hiii
return done(null,data)
>too hame likhnaa haii kii return hogaa error hahin haii
to error kee jaga mee null or dand data hamme pass karna hai
>yeh jooo data haii woo particular user hotta haiiii
>too hamare code aabhi passport localkese dikeega ham likhl
lete haiii in routes.js mee
var localStrategy=require('passport-local').Startegy;
passport.use(new localStartegy({usernameField:email},
(username,password,done)={
if(err) throw err;
if(!data){

return done(null,false);
}
bcrypt.compare(passowrd,data.password,(err,match)=>{
if(err){

return done(null,false);
}
if(!match){
return done(null,false);
}
if(match){
return done(null,data)
}
})
}))

too isko ham ab routes.js me lagakee dekhleteee haiii
routes.js
==============


routes.js
===========
const express=require("express");
const routes=express.Router();
const mongoose=require("mongoose");
const user=require("./user");
mongoose.connect("url",{useNewUrlParser:true,useUnifiedTopology:true}).
then(()=>{
console.log("db connected")});
const bodyparser=require("body-parser");
router.use(bodyparser.urlencoded({extended:true}));
routes.get("/",(req,res)=>{
res.render("index");
res.send("hii  from routes");
});

router.post("/register",(req,res)=>{
var{email,username,password,confirmpassword}=req.body;
var err;
if{!email||!password||!confirmpassword){
err="please fill all the fields";
res.render('index',{'err':err});
}
if(password!=confirmpassword){
err="password dont match";
res.render("index",{'err':err,'email':email,'username':username});
}
if(typeof err="undefind"){
user..findOne({email:email},function(err,data){
if(err) throw err;
if(data){
console.log("user exists");
err="user already exists with this email....."
res.render("index",{'err':err,'email':email,username:'username'})
}else{
bcrypt.genSalt(10,(err,salt)=>{
if(err) throw err;
bcrypt.hash(password,salt,(err,hash)=>{
if(err) throw err;
password=hash;
user({
email,
username,
password
}).save((err,data)=>{
if(err) throw err;
res.redirect("/login")
})})}}})}});


var localStrategy=require('passport-local').Startegy;
passport.use(new localStartegy({usernameField:email},
(username,password,done)={
if(err) throw err;
if(!data){

return done(null,false);
}
bcrypt.compare(passowrd,data.password,(err,match)=>{
if(err){

return done(null,false);
}
if(!match){
return done(null,false);
}
if(match){
return done(null,data)
}
})
}))

routes.get("/login",(req,res)=>{
res.render('login');
})





module.exports=routes;


aab ham login koo kese ues kartee haii obvioulsyy ham login
koo post route use karteee haiii
>too ham login mee kiya karnegee routes.post("/login") jaha
pee hamare values hoga aab yeh hamare normal route nahiiin haii
>yaha par hamm thoda alag kam kartee haiiii
>ismee hamare post login mee hamare request or response kee 
sath eek next milegaa
>40.06


